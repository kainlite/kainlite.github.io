(function(a,g){var b=a('.ins-search'),j=b.find('.ins-search-input'),c=b.find('.ins-section-wrapper'),e=b.find('.ins-section-container');b.parent().remove('.ins-search'),a('body').append(b);function r(b){return a('<section>').addClass('ins-section').append(a('<header>').addClass('ins-section-header').text(b))}function i(e,b,c,d,f){return a('<div>').addClass('ins-selectable').addClass('ins-search-item').append(a('<header>').append(a('<i>').addClass('icon').addClass('icon-'+e)).append(b!=null&&b!=''?b:g.TRANSLATION.UNTITLED).append(c?a('<span>').addClass('ins-slug').text(c):null)).append(d?a('<p>').addClass('ins-search-preview').text(d):null).attr('data-url',f)}function s(a,b){var d,c;if(b.length===0)return null;switch(d=g.TRANSLATION[a],a){case'POSTS':c=b.map(function(a){return i('file',a.title,null,a.content.slice(0,150),a.uri)});break;case'CATEGORIES':case'TAGS':c=b.map(function(b){return i(a==='CATEGORIES'?'folder':'tag',b.title,'',null,b.uri)});break;default:return null}return r(d).append(c)}function k(a){return a.split(' ').filter(function(a){return!!a}).map(function(a){return a.toUpperCase()})}function d(c,a,d){var f=!1,b=k(c),e=b.filter(function(b){var c=d.filter(function(c){if(!a.hasOwnProperty(c))return!1;if(a[c].toUpperCase().indexOf(b)>-1)return!0});return c.length>0});return e.length===b.length}function m(a){return{POST:function(b){return d(a,b,['title','content'])},PAGE:function(b){return d(a,b,['title','content'])},CATEGORY:function(b){return d(a,b,['title'])},TAG:function(b){return d(a,b,['title'])}}}function f(c,a,d,e){var b=0;return k(c).forEach(function(c){var f=new RegExp(c,'img');d.forEach(function(c,g){if(a.hasOwnProperty(c)){var d=a[c].match(f);b+=d?d.length*e[g]:0}})}),b}function n(a){return{POST:function(b){return f(a,b,['title','content'],[3,1])},PAGE:function(b){return f(a,b,['title','content'],[3,1])},CATEGORY:function(b){return f(a,b,['title'],[1])},TAG:function(b){return f(a,b,['title'],[1])}}}function o(b,d){var a=n(d),c=m(d),e=b.posts,f=b.tags,g=b.categories;return{posts:e.filter(c.POST).sort(function(b,c){return a.POST(c)-a.POST(b)}).slice(0,5),categories:g.filter(c.CATEGORY).sort(function(b,c){return a.CATEGORY(c)-a.CATEGORY(b)}).slice(0,5),tags:f.filter(c.TAG).sort(function(b,c){return a.TAG(c)-a.TAG(b)}).slice(0,5)}}function p(a){e.empty();for(var b in a)e.append(s(b.toUpperCase(),a[b]))}function q(a){var d,e,b;if(a.length===0)return;d=c[0].clientHeight,e=a.position().top-c.scrollTop(),b=a[0].clientHeight+a.position().top,b>d+c.scrollTop()&&c.scrollTop(b-c[0].clientHeight),e<0&&c.scrollTop(a.position().top)}function h(f){var b=a.makeArray(e.find('.ins-selectable')),c=-1,d;b.forEach(function(b,d){if(a(b).hasClass('active')){c=d;return}}),d=(b.length+c+f)%b.length,a(b[c]).removeClass('active'),a(b[d]).addClass('active'),q(a(b[d]))}function l(a){a&&a.length&&(location.href=a.attr('data-url'))}a.getJSON(g.CONTENT_URL,function(c){location.hash.trim()==='#ins-search'&&b.addClass('show'),j.on('input',function(){var b=a(this).val();p(o(c,b))}),j.trigger('input')}),a(document).on('click focus','.search-form-input',function(){b.addClass('show'),b.find('.ins-search-input').focus()}).on('click','.ins-search-item',function(){l(a(this))}).on('click','.ins-close',function(){b.removeClass('show')}).on('keydown',function(a){if(!b.hasClass('show'))return;switch(a.keyCode){case 27:b.removeClass('show');break;case 38:h(-1);break;case 40:h(1);break;case 13:l(e.find('.ins-selectable.active').eq(0));break}})})(jQuery,window.INSIGHT_CONFIG)